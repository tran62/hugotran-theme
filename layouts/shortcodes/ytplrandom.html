{{- $id := .Get "id" | default (.Get 0) -}}
{{- $player := .Get "player" | default "player" }}
{{- $class := .Get "class" | default (.Get 1) -}}
{{- $title := .Get "title" | default "YouTube Video" }}
<!-- 1. The <iframe> (and video player) will replace this <div> tag.  
style =  replaces  size in the player script makes it responsive -->
<div  {{ with $class }}class="{{ . }}"
{{ else }}style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;"{{ end }}>
  <iframe  id="{{ $player }}" 
  src="https://www.youtube.com/embed/videoseries?list={{ $id }}&enablejsapi=1"  
  {{ if not $class }}style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;"
  {{ end }} 
  allow="fullscreen;"
  title="{{ $title }}">
  </iframe>
</div>

<script>
  // 2. This code loads the IFrame Player API code asynchronously.
var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // 3. This function creates an <iframe> (and YouTube player)
  //    after the API code downloads.

//var player ;
var player1, player2, player3, player4 ;

async function onYouTubeIframeAPIReady() {
 player1   = new YT.Player("player1", {
 playerVars: {
  'autoplay': 0,'loop': 0,'controls': 1,
  'showinfo': 1,'frameborder': 1,'fs': 1,
  'listType': 'playlist',
  },

 events: {
  'onReady': onPlayerReady,
  'onStateChange': onPlayerStateChange,
  'onError': function(e){
                e.target.nextVideo();
                e.target.playVideo();
              }
  }
  }); // end YT.Player()
 
 player2   = new YT.Player("player2", {
 playerVars: {
  'autoplay': 0,'loop': 0,'controls': 1,
  'showinfo': 1,'frameborder': 1,
  'fs': 1,'listType': 'playlist',
  },

 events: {
  'onReady': onPlayerReady,
  'onStateChange': onPlayerStateChange,
  'onError': function(e){
                e.target.nextVideo();
                e.target.playVideo();
              }
  }
  }); // end YT.Player2

 player3   = new YT.Player("player3", {
 playerVars: {
  'autoplay': 0,'loop': 0,'controls': 1,
  'showinfo': 1,'frameborder': 1,
  'fs': 1,'listType': 'playlist',
  },

 events: {
  'onReady': onPlayerReady,
  'onStateChange': onPlayerStateChange,
  'onError': function(e){
                e.target.nextVideo();
                e.target.playVideo();
              }
  }
  }); // end YT.Player3

 player4   = new YT.Player("player4", {
 playerVars: {
  'autoplay': 0,'loop': 0,'controls': 1,
  'showinfo': 1,'frameborder': 1,
  'fs': 1,'listType': 'playlist',
  },

 events: {
  'onReady': onPlayerReady,
  'onStateChange': onPlayerStateChange,
  'onError': function(e){
                e.target.nextVideo();
                e.target.playVideo();
              }
  }
  }); // end YT.Player()

 } // end function onYoutubeIframeAPIReady()

  // 4. The API will call this function when the video player is ready.

 async function onPlayerReady(event) {
  // first shuffle play list 

 player1.setShuffle(true); 
 player2.setShuffle(true); 
 player3.setShuffle(true);
 player4.setShuffle(true);

  // Onload and on refresh shuffles the users YT playlist but always starts playing 
  // the first video in the original list at its new index position 
  //ie. video (1) = video( new shuffled pos ?)
  // to get over this we can start the player at the new shuffled playlist 
  //video 1(index=0) this changes every time it's refreshed

 player1.playVideoAt(0); 
 player2.playVideoAt(0);
 player3.playVideoAt(0);
 player4.playVideoAt(0); 
 
 }
  // 5. The API calls this function when the player's state changes.
  //  option to to add bits         
 async function onPlayerStateChange(event) {
  const player1 = event.target
  const player2 = event.target
  const player3 = event.target
  const player4 = event.target
  
  
 }
 
 
 </script>